{% extends "layout.html" %}

{% block title %}Registrar Base - BIGODETEXAS - XBOX{% endblock %}

{% block extra_head %}
<style>
    .base-container {
        max-width: 1400px;
        margin: 2rem auto;
        padding: 0 2rem;
    }

    .base-header {
        text-align: center;
        margin-bottom: 3rem;
    }

    .base-header h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
    }

    .base-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 2rem;
    }

    .map-section {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 1rem;
        padding: 0;
        overflow: hidden;
        height: 700px;
    }

    .info-section {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 1rem;
        padding: 1.5rem;
        height: fit-content;
    }

    .info-card {
        background: rgba(255, 255, 255, 0.03);
        padding: 1rem;
        border-radius: 0.5rem;
        margin-bottom: 1rem;
    }

    .info-card h3 {
        margin-bottom: 0.5rem;
        color: var(--accent);
    }

    .coord-inputs {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 10px;
    }

    .register-btn {
        width: 100%;
        padding: 1rem;
        background: var(--accent);
        color: #000;
        border: none;
        border-radius: 0.5rem;
        font-weight: 700;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .register-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
    }

    .register-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .warning-box {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: #ef4444;
        padding: 1rem;
        border-radius: 0.5rem;
        margin-bottom: 1rem;
    }

    .success-box {
        background: rgba(34, 197, 94, 0.1);
        border: 1px solid rgba(34, 197, 94, 0.3);
        color: #22c55e;
        padding: 1rem;
        border-radius: 0.5rem;
        margin-bottom: 1rem;
    }

    @media (max-width: 1024px) {
        .base-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="base-container">
    <div class="base-header">
        <h1><i class="ri-map-pin-fill" style="color: var(--accent);"></i> Registrar Base</h1>
        <p>Utilize o mapa iZurvive abaixo para encontrar suas coordenadas e registre sua base.</p>
    </div>

    <div class="base-grid">
        <div class="map-section">
            <iframe src="https://www.izurvive.com/chernarusplussatma" width="100%" height="100%" frameborder="0"
                style="border:0;" allowfullscreen></iframe>
        </div>

        <div class="info-section">
            <h2>Informações da Base</h2>

            <div id="registration-form">
                <div class="info-card">
                    <h3>Coordenadas</h3>
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                        Consulte o mapa ao lado ou seu GPS no jogo.
                    </p>
                    <div class="coord-inputs">
                        <div>
                            <label>Eixo X</label>
                            <input type="number" id="coord-x" class="search-input" placeholder="0" min="0" max="15360">
                        </div>
                        <div>
                            <label>Eixo Y</label>
                            <input type="number" id="coord-y" class="search-input" placeholder="0" min="0" max="15360">
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <h3>Nome da Base (Opcional)</h3>
                    <input type="text" id="base-name" class="search-input" placeholder="Ex: Fortaleza do Texas"
                        maxlength="50">
                </div>

                <div class="info-card">
                    <h3>Raio de Proteção</h3>
                    <p style="color: var(--text-secondary);">50 metros (padrão)</p>
                    <small>Apenas membros do seu clã poderão construir nesta área</small>
                </div>

                <div class="warning-box">
                    <strong><i class="ri-alert-line"></i> ATENÇÃO:</strong><br>
                    • Você só pode registrar 1 base<br>
                    • A localização não pode ser alterada depois<br>
                </div>

                <button class="register-btn" id="register-btn" onclick="registerBase()">
                    <i class="ri-save-line"></i> Registrar Base
                </button>
            </div>

            <div id="success-message" style="display: none;" class="success-box">
                <i class="ri-checkbox-circle-line"></i> Base registrada com sucesso!
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    async function registerBase() {
        const coordX = document.getElementById('coord-x').value;
        const coordY = document.getElementById('coord-y').value;
        const baseName = document.getElementById('base-name').value || null;

        if (!coordX || !coordY) {
            alert('Por favor, insira as coordenadas X e Y!');
            return;
        }

        const btn = document.getElementById('register-btn');
        btn.disabled = true;
        btn.textContent = 'Registrando...';

        try {
            const response = await fetch('/api/base/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    coord_x: parseInt(coordX),
                    coord_y: parseInt(coordY),
                    coord_z: 0,
                    name: baseName
                })
            });

            const data = await response.json();

            if (response.ok) {
                document.getElementById('registration-form').style.display = 'none';
                document.getElementById('success-message').style.display = 'block';
                setTimeout(() => {
                    window.location.href = '/clan';
                }, 2000);
            } else {
                alert(data.error || 'Erro ao registrar base');
                btn.disabled = false;
                btn.innerHTML = '<i class="ri-save-line"></i> Registrar Base';
            }
        } catch (error) {
            console.error('Erro:', error);
            alert('Erro ao registrar base');
            btn.disabled = false;
            btn.innerHTML = '<i class="ri-save-line"></i> Registrar Base';
        }
    }
</script>

<!-- Sistema de Notificações -->
<script src="{{ url_for('static', filename='js/notifications.js') }}"></script>
{% endblock %}