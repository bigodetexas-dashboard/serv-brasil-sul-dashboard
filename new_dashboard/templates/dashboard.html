{% extends "layout.html" %}

{% block title %}{{ _('Meu Perfil') }} - BIGODETEXAS - XBOX{% endblock %}

{% block extra_head %}
<!-- Dashboard CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
<!-- Chart.js (caso seja usado para stats futuros, mantendo por garantia) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
{% endblock %}

{% block content %}
<div class="container dashboard-container">
    <!-- Perfil Header -->
    <div class="profile-header">
        <div class="profile-avatar">
            <img id="user-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" alt="Avatar">
        </div>
        <div class="profile-info">
            <h1 id="user-name">{{ _('Carregando...') }}</h1>
            <p class="gamertag">Gamertag: <span id="user-gamertag" class="text-accent">...</span></p>
            <div class="profile-badges">
                <span class="badge badge-vip">VIP</span>
                <span class="badge badge-veteran">{{ _('Veterano') }}</span>
                <span id="xbox-verified-badge" class="badge badge-success"
                    style="display: none; background-color: #107c10; color: white;">
                    <i class="ri-xbox-line"></i> {{ _('Xbox Verificado') }}
                </span>
            </div>
        </div>
        <div class="profile-balance">
            <div class="balance-label">{{ _('Saldo Atual') }}</div>
            <div class="balance-amount"><span id="user-balance">0</span> üí∞</div>
            <button onclick="document.getElementById('modal-transfer').style.display='flex'"
                class="btn btn-primary btn-sm">{{ _('Transferir Coins') }}</button>
            <button onclick="claimDaily()" id="btn-daily" class="btn btn-sm"
                style="background: linear-gradient(45deg, #FFD700, #FFA500); color: black; font-weight: bold; box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);">
                <i class="ri-gift-2-line"></i> {{ _('Daily') }}
            </button>
        </div>
    </div>

    <!-- Alerta de Verifica√ß√£o -->
    <div id="verification-warning" class="alert alert-warning mt-4"
        style="display: none; background: rgba(255, 165, 0, 0.1); border: 1px solid rgba(255, 165, 0, 0.3); border-radius: 8px; padding: 20px;">
        <div style="display: flex; gap: 15px; align-items: flex-start;">
            <div style="font-size: 2rem; color: #ffa500;"><i class="ri-error-warning-line"></i></div>
            <div>
                <h3 style="color: #ffa500; margin-bottom: 5px; font-size: 1.2rem;">{{ _('Sua conta Xbox n√£o est√°
                    verificada!') }}</h3>
                <p style="color: rgba(255,255,255,0.8); margin-bottom: 15px; font-size: 0.95rem;">
                    {{ _('Voc√™ precisa verificar sua Gamertag para realizar compras na loja e acessar recursos
                    exclusivos.') }}
                </p>
                <div class="mt-4"
                    style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div class="verify-step">
                            <div class="step-icon"><i class="ri-discord-fill"></i></div>
                            <h4>1. {{ _('Abra o Discord') }}</h4>
                            <p>{{ _('V√° em <strong>Configura√ß√µes de Usu√°rio</strong> (engrenagem) e clique na aba
                                <strong>Conex√µes</strong>.') }}</p>
                        </div>
                        <div class="verify-step">
                            <div class="step-icon" style="color: #107c10;"><i class="ri-xbox-line"></i></div>
                            <h4>2. {{ _('Adicione o Xbox') }}</h4>
                            <p>{{ _('Clique no √≠cone do <strong>Xbox</strong> e fa√ßa login com sua conta Microsoft.') }}
                            </p>
                        </div>
                        <div class="verify-step">
                            <div class="step-icon" style="color: #4facfe;"><i class="ri-eye-line"></i></div>
                            <h4>3. {{ _('O Pulo do Gato') }}</h4>
                            <p>{{ _('Ative a chavinha <strong>"Exibir no perfil"</strong>. Sem isso, o bot n√£o v√™ sua
                                conta!') }}</p>
                        </div>
                        <div class="verify-step">
                            <div class="step-icon" style="color: #22c55e;"><i class="ri-check-double-line"></i>
                            </div>
                            <h4>4. {{ _('Finalizar') }}</h4>
                            <p>{{ _('Tudo pronto? Clique no bot√£o abaixo para verificar.') }}</p>
                        </div>
                    </div>

                    <div class="mt-4 text-center">
                        <a href="/logout" class="btn btn-primary"
                            style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border: none; padding: 12px 30px; font-weight: 600;">
                            <i class="ri-refresh-line"></i> {{ _('J√Å VINCULEI! ATUALIZAR AGORA') }}
                        </a>
                        <p style="margin-top: 10px; font-size: 0.8rem; color: rgba(255,255,255,0.5);">
                            {{ _('(Voc√™ ser√° deslogado para que o bot leia suas novas conex√µes)') }}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Estat√≠sticas -->
    <div class="tab-content active" id="tab-stats">
        <div class="stats-section">
            <h2><i class="ri-bar-chart-2-line"></i> {{ _('Estat√≠sticas de Combate') }}</h2>
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-icon"><i class="ri-sword-line"></i></div>
                    <div class="stat-data">
                        <span class="stat-value" id="stat-kills">0</span>
                        <span class="stat-label">{{ _('Kills') }}</span>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon"><i class="ri-skull-line"></i></div>
                    <div class="stat-data">
                        <span class="stat-value" id="stat-deaths">0</span>
                        <span class="stat-label">{{ _('Mortes') }}</span>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon"><i class="ri-percent-line"></i></div>
                    <div class="stat-data">
                        <span class="stat-value" id="stat-kd">0.0</span>
                        <span class="stat-label">{{ _('K/D Ratio') }}</span>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon"><i class="ri-ghost-line"></i></div>
                    <div class="stat-data">
                        <span class="stat-value" id="stat-zombies">0</span>
                        <span class="stat-label">{{ _('Zumbis Mortos') }}</span>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon"><i class="ri-fire-line"></i></div>
                    <div class="stat-data">
                        <span class="stat-value" id="stat-streak">0</span>
                        <span class="stat-label">{{ _('Melhor S√©rie') }}</span>
                    </div>
                </div>
            </div>

            <h2 class="mt-4"><i class="ri-map-pin-user-line"></i> {{ _('Sobreviv√™ncia') }}</h2>
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-icon"><i class="ri-time-line"></i></div>
                    <div class="stat-data">
                        <span class="stat-value" id="stat-playtime">0h</span>
                        <span class="stat-label">{{ _('Tempo Jogado') }}</span>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon"><i class="ri-footprint-line"></i></div>
                    <div class="stat-data">
                        <span class="stat-value" id="stat-distance">0km</span>
                        <span class="stat-label">{{ _('Dist√¢ncia (P√©)') }}</span>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon"><i class="ri-roadster-line"></i></div>
                    <div class="stat-data">
                        <span class="stat-value" id="stat-driving">0km</span>
                        <span class="stat-label">{{ _('Dist√¢ncia (Carro)') }}</span>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon"><i class="ri-hammer-line"></i></div>
                    <div class="stat-data">
                        <span class="stat-value" id="stat-built">0</span>
                        <span class="stat-label">{{ _('Constru√ß√µes') }}</span>
                    </div>
                </div>
            </div>

            <div class="mt-5">
                <h2 class="section-title"><i class="ri-team-line"></i> {{ _('Cl√£ e Comunica√ß√£o') }}</h2>

                <!-- Clan Status -->
                <div id="clan-status-container" class="mt-3">
                    <p class="text-muted">{{ _('Carregando informa√ß√µes do cl√£...') }}</p>
                </div>

                <!-- Clan Chat (R√°dio) -->
                <div id="clan-chat-container" class="clan-chat-box mt-4" style="display: none;">
                    <div class="chat-header">
                        <h3><i class="ri-broadcast-line"></i> {{ _('R√°dio de Cl√£ (Chat Interno)') }}</h3>
                        <span class="status-indicator">‚óè {{ _('AO VIVO') }}</span>
                    </div>
                    <div id="chat-messages" class="chat-messages-area">
                        <!-- Messages injected by JS -->
                        <div class="text-center p-4 text-muted">{{ _('Aguardando mensagens...') }}</div>
                    </div>
                    <form id="chat-form" class="chat-input-area">
                        <input type="text" id="chat-input" placeholder="{{ _('Digite uma mensagem t√°tica...') }}"
                            maxlength="200" autocomplete="off">
                        <button type="submit" class="btn-send"><i class="ri-send-plane-2-line"></i></button>
                    </form>
                </div>

                <div id="invites-container" class="mt-3" style="display:none;">
                    <h3 style="font-size: 1.1rem; color: var(--accent); margin-bottom: 10px;">{{ _('Convites Pendentes')
                        }}
                    </h3>
                    <div id="invites-list" style="display: grid; gap: 10px;"></div>
                </div>
            </div>

            <div class="mt-5" id="clan-war-section" style="display: none;">
                <h2 class="section-title" style="color: #ff4d4d;"><i class="ri-sword-line"></i> {{ _('Guerra de Cl√£s')
                    }}</h2>
                <div id="clan-war-container" class="war-card mt-3">
                    <!-- War info injected by JS -->
                </div>
            </div>

            <div class="mt-5">
                <h2 class="section-title"><i class="ri-money-dollar-circle-line"></i> {{ _('Bumbas Ativas (Bounties)')
                    }}</h2>
                <div id="bounties-container" class="bounties-list mt-3">
                    <p class="text-muted">{{ _('Nenhuma recompensa ativa no momento.') }}</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ONBOARDING MODAL (TUTORIAL) -->
<div id="onboarding-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content glass-panel">
        <button class="modal-close" onclick="closeTutorial()">
            <i class="ri-close-line"></i>
        </button>

        <div class="tutorial-slider">
            <!-- Slide 1: Welcome -->
            <div class="tutorial-slide active" data-step="1">
                <div class="slide-icon-container">
                    <img src="{{ url_for('static', filename='img/logo_texas.png') }}" class="slide-logo pulse-anim">
                </div>
                <h2>{{ _('Bem-vindo ao BigodeTexas') }}</h2>
                <p>{{ _('Seu painel de controle completo para o apocalipse.') }}</p>
                <div class="slide-content">
                    <p>{{ _('Aqui voc√™ gerencia sua sobreviv√™ncia, economia e reputa√ß√£o no servidor mais brabo do
                        Xbox.') }}</p>
                    <ul class="feature-list">
                        <li><i class="ri-shield-check-line"></i> {{ _('Prote√ß√£o de Base') }}</li>
                        <li><i class="ri-money-dollar-circle-line"></i> {{ _('Economia Real') }}</li>
                        <li><i class="ri-skull-line"></i> {{ _('Killfeed & Ranking') }}</li>
                    </ul>
                </div>
                <div class="slide-actions">
                    <button class="btn btn-primary btn-lg" onclick="nextSlide()">{{ _('Come√ßar Tour') }} <i
                            class="ri-arrow-right-line"></i></button>
                </div>
            </div>

            <!-- Slide 2: Xbox Verification -->
            <div class="tutorial-slide" data-step="2">
                <div class="slide-icon-container">
                    <i class="ri-xbox-fill slide-icon xbox-color"></i>
                </div>
                <h2>{{ _('Uni√£o de Contas') }}</h2>
                <p>{{ _('O Fim das Contas Fantasmas.') }}</p>
                <div class="slide-content">
                    <div class="info-card warning-border">
                        <h3><i class="ri-alert-line"></i> {{ _('Por que vincular?') }}</h3>
                        <p>{{ _('Ao vincular, o sistema UNE seu Discord e Xbox em <strong>UMA √öNICA
                                IDENTIDADE</strong>.') }}</p>
                        <p style="margin-top: 5px;">{{ _('Isso evita duplicidade e garante que seu dinheiro e ranking
                            sejam atribu√≠dos corretamente.') }}</p>
                    </div>
                </div>
                <div class="slide-actions">
                    <button class="btn btn-secondary" onclick="prevSlide()">{{ _('Voltar') }}</button>
                    <button class="btn btn-primary" onclick="nextSlide()">{{ _('Pr√≥ximo') }} <i
                            class="ri-arrow-right-line"></i></button>
                </div>
            </div>

            <!-- Slide 3: Clan & Base -->
            <div class="tutorial-slide" data-step="3">
                <div class="slide-icon-container">
                    <i class="ri-shield-star-line slide-icon gold-color"></i>
                </div>
                <h2>{{ _('Prote√ß√£o Total') }}</h2>
                <p>{{ _('Dorme tranquilo. O BigodeBot vigia sua base.') }}</p>
                <div class="slide-content">
                    <div class="grid-2-mini">
                        <div class="mini-card">
                            <h4><i class="ri-team-line"></i> {{ _('Cl√£') }}</h4>
                            <p>{{ _('Crie um cl√£ para compartilhar permiss√µes de portas e bancos com seus amigos.') }}
                            </p>
                        </div>
                        <div class="mini-card">
                            <h4><i class="ri-home-wifi-line"></i> {{ _('Base') }}</h4>
                            <p>{{ _('Registre sua base (comando !alarme). O bot bane quem tentar "glitchar" ou invadir
                                ilegalmente!') }}</p>
                        </div>
                    </div>
                </div>
                <div class="slide-actions">
                    <button class="btn btn-secondary" onclick="prevSlide()">{{ _('Voltar') }}</button>
                    <button class="btn btn-primary" onclick="nextSlide()">{{ _('Pr√≥ximo') }} <i
                            class="ri-arrow-right-line"></i></button>
                </div>
            </div>

            <!-- Slide 4: Benefits -->
            <div class="tutorial-slide" data-step="4">
                <div class="slide-icon-container">
                    <i class="ri-vip-crown-2-line slide-icon royal-color"></i>
                </div>
                <h2>{{ _('Vantagens Exclusivas') }}</h2>
                <p>{{ _('Jogue, lucre e domine o ranking.') }}</p>
                <div class="slide-content">
                    <ul class="benefit-list">
                        <li><span>üí∞</span> <strong>{{ _('Sal√°rio:') }}</strong> {{ _('Ganhe coins a cada 10min
                            online.') }}</li>
                        <li><span>üõí</span> <strong>{{ _('Shop:') }}</strong> {{ _('Compre itens e receba no jogo (Spawn
                            autom√°tico).') }}</li>
                        <li><span>üìä</span> <strong>{{ _('Ranking:') }}</strong> {{ _('Dispute o Top 1 Kill/Death do
                            servidor.') }}</li>
                    </ul>
                    <div class="final-msg">{{ _('Tudo pronto? Vamos nessa!') }}</div>
                </div>
                <div class="slide-actions">
                    <button class="btn btn-secondary" onclick="prevSlide()">{{ _('Voltar') }}</button>
                    <button class="btn btn-primary btn-lg" onclick="finishTutorial()">{{ _('ACESSAR PAINEL') }} <i
                            class="ri-check-double-line"></i></button>
                </div>
            </div>
        </div>

        <div class="tutorial-progress">
            <div class="step active" id="step-dot-1"></div>
            <div class="step" id="step-dot-2"></div>
            <div class="step" id="step-dot-3"></div>
            <div class="step" id="step-dot-4"></div>
        </div>
    </div>
</div>

<!-- MODAL TRANSFER√äNCIA -->
<div id="modal-transfer" class="modal-overlay"
    style="display: none; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999;">
    <div class="modal-content glass-panel" style="max-width: 400px; position: relative;">
        <button class="modal-close" onclick="document.getElementById('modal-transfer').style.display='none'"
            style="position: absolute; top: 10px; right: 10px; background: none; border: none; color: white; cursor: pointer; font-size: 1.5rem;">
            <i class="ri-close-line"></i>
        </button>
        <div class="text-center mb-4" style="text-align: center; margin-bottom: 20px;">
            <i class="ri-bank-line" style="font-size: 3rem; color: var(--primary);"></i>
            <h2 class="mt-2">{{ _('Banco Texas') }}</h2>
            <p class="text-muted">{{ _('Transfer√™ncia de DZ Coins') }}</p>
        </div>

        <form id="transfer-form">
            <div class="form-group mb-3" style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px;">{{ _('Gamertag do Destinat√°rio') }}</label>
                <input type="text" id="transfer-target" class="form-control" placeholder="{{ _('Ex: Player123') }}"
                    required
                    style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white; border-radius: 6px;">
            </div>
            <div class="form-group mb-4" style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px;">{{ _('Valor (DZ Coins)') }}</label>
                <input type="number" id="transfer-amount" class="form-control" min="1" placeholder="0" required
                    style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white; border-radius: 6px;">
            </div>
            <button type="submit" class="btn btn-primary w-100" style="width: 100%; padding: 12px; font-weight: bold;">
                <i class="ri-exchange-dollar-line"></i> {{ _('Confirmar Transfer√™ncia') }}
            </button>
        </form>
    </div>
</div>

<!-- MODAL DECLARAR GUERRA -->
<div id="modal-declare-war" class="modal-overlay"
    style="display: none; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999;">
    <div class="modal-content glass-panel"
        style="max-width: 400px; position: relative; border: 1px solid #ff4d4d; box-shadow: 0 0 20px rgba(255, 77, 77, 0.3);">
        <button class="modal-close" onclick="document.getElementById('modal-declare-war').style.display='none'"
            style="position: absolute; top: 10px; right: 10px; background: none; border: none; color: white; cursor: pointer; font-size: 1.5rem;">
            <i class="ri-close-line"></i>
        </button>
        <div class="text-center mb-4" style="text-align: center; margin-bottom: 20px;">
            <i class="ri-sword-line" style="font-size: 3rem; color: #ff4d4d;"></i>
            <h2 class="mt-2" style="color: #ff4d4d;">{{ _('DECLARAR GUERRA') }}</h2>
            <p class="text-muted">{{ _('Escolha um cl√£ inimigo para iniciar o conflito.') }}</p>
        </div>

        <form id="war-form" onsubmit="event.preventDefault(); submitWarDeclaration();">
            <div class="form-group mb-4" style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px;">{{ _('Selecione o Inimigo') }}</label>
                <select id="war-target-clan" class="form-control" required
                    style="width: 100%; padding: 10px; background: rgba(0,0,0,0.3); border: 1px solid #ff4d4d; color: white; border-radius: 6px;">
                    <option value="">{{ _('Carregando cl√£s...') }}</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary w-100"
                style="width: 100%; padding: 12px; font-weight: bold; background: #ff4d4d; border: none;">
                <i class="ri-skull-line"></i> {{ _('INICIAR GUERRA') }}
            </button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}