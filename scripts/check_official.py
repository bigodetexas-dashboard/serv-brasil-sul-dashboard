import xml.etree.ElementTree as ET
import sys

# Official spawns for VehicleTruck01 extracted from Bohemia GitHub (Chunks 14+15)
official_spawns = [
    (2906.678223, 9736.077148),
    (1577.859375, 10434.791992),
    (4986.840332, 12949.183594),
    (7041.077148, 14531.375977),
    (5960.123535, 10146.770508),
    (8667.684570, 13278.957031),
    (5664.543457, 13129.942383),
    (4832.317871, 10236.031250),
    (5276.042481, 10581.310547),
    (1045.962647, 9971.117188),
    (5227.710938, 11521.333984),
    (7702.665039, 12682.482422),
    (3789.952637, 13001.110352),
    (1798.839722, 9127.887695),
    (2009.389771, 10077.943359),
    (7735.354980, 14834.541016),
    (8857.023437, 11649.842774),
    (4131.821289, 13122.179687),
    (2276.999268, 15255.469727),
    (1522.324341, 14049.371094),
    (3251.315430, 13731.794922),
    (5770.530762, 15185.775391),
    (4406.640625, 13568.414062),
    (5262.253418, 6515.275879),
    (7748.413086, 5119.576660),
    (3575.642578, 6990.220703),
    (7791.013184, 6910.817383),
    (7076.023438, 2689.005371),
    (6427.401367, 6204.350586),
    (3633.469727, 3692.717285),
    (4541.975098, 4531.494141),
    (4429.652832, 8215.291992),
    (2220.089111, 5200.035645),
    (560.186584, 5410.156738),
    (4637.476074, 9505.052734),
    (8405.373047, 6596.034668),
    (6944.259766, 7693.539063),
    (1364.592285, 4114.649414),
    (8409.633789, 4441.648926),
    (323.456787, 3020.537353),
    (2206.372803, 3372.271973),
    (3012.489502, 6762.072754),
    (1277.925171, 6371.556152),
    (2041.322510, 12167.145508),
    (7299.304687, 3309.203125),
    (10554.303711, 14322.004883),
    (6265.714844, 3786.625244),
    (10362.692383, 7419.507324),
    (9004.064453, 5989.230469),
    (2733.107910, 5996.250488),
    (5339.345215, 8617.464844),
    (5678.402344, 2970.320557),
    (10224.086914, 1893.061279),
    (13058.676758, 7050.820801),
    (11327.027344, 12564.874023),
    (12031.156250, 14331.597656),
    (7414.633789, 2902.156738),
    (9372.827149, 2017.390381),
    (13448.585938, 14281.957031),
    (12373.672852, 14194.493164),
    (12766.938476, 9737.385742),
    (12291.955078, 9180.900391),
    (9914.125000, 6694.112793),
    (9851.080078, 8710.079102),
    (11758.238281, 6440.636719),
    (12659.405273, 8792.730469),
    (7043.717285, 2621.930664),
    (12046.332031, 5117.613770),
    (12899.312500, 6273.381836),
    (10289.288086, 14176.590820),
    (2253.827881, 10861.227539),
    (4193.801270, 8920.323242),
    (6324.339844, 7708.424805),
    (5281.719238, 5511.826660),
    (8214.020508, 9051.356445),
    (981.095154, 7679.972168),
    (9186.639649, 8092.542480),
    (4045.417725, 11620.316406),
    (4957.879395, 13034.267578),
    (7711.225586, 3541.843994),
    (5258.474609, 9789.590820),
    (4812.191895, 10559.252930),
    (7203.168457, 8263.751953),
    (5081.934570, 12738.611328),
    (289.986878, 6591.820801),
    (2311.394287, 5205.620117),
    (3040.473633, 12342.300781),
    (3115.170654, 9212.784180),
    (1927.795776, 8118.223633),
    (11119.620117, 11950.378906),
    (12252.349609, 10592.278320),
    (10268.226563, 9484.834961),
    (1832.745239, 2141.662842),
    (9788.372070, 12659.518555),
    (3588.894531, 2191.542969),
    (12739.316406, 15065.678711),
    (4962.440430, 2423.164063),
    (12447.697266, 12526.000977),
    (9684.465820, 8900.208984),
    (11443.111328, 7523.010254),
    (8076.944824, 3367.088135),
    (12658.772461, 14744.561523),
    (13471.389648, 13067.444336),
    (11714.461914, 14243.904297),
    (12304.988281, 14322.949219),
    (11951.045898, 12505.055664),
    (10933.639648, 13386.339844),
    (11617.635742, 7294.687988),
    (12907.009766, 6278.379395),
    (9901.132813, 5467.663574),
    (10257.797851, 3617.499512),
]


def calculate_distance(p1, p2):
    return ((p1[0] - p2[0]) ** 2 + (p1[1] - p2[1]) ** 2) ** 0.5


def check_official_integrity():
    input_xml = "temp_spawns.xml"
    try:
        tree = ET.parse(input_xml)
        root = tree.getroot()
    except Exception as e:
        print(f"Error parsing XML: {e}")
        return

    avoidance_points = []
    avoidance_events = [
        "StaticHeliCrash",
        "StaticPoliceCar",
        "StaticPoliceSituation",
        "StaticMilitaryConvoy",
    ]

    for event in root.findall("event"):
        name = event.get("name")
        if name in avoidance_events:
            for pos in event.findall("pos"):
                x = float(pos.get("x"))
                z = float(pos.get("z"))
                avoidance_points.append((x, z))

    print(
        f"Checking {len(official_spawns)} Official Spawns against {len(avoidance_points)} Server Events..."
    )

    conflicts = 0
    threshold = 100.0  # Same strict threshold

    for i, (tx, tz) in enumerate(official_spawns):
        is_safe = True
        for ax, az in avoidance_points:
            dist = calculate_distance((tx, tz), (ax, az))
            if dist < threshold:
                print(
                    f"   [OFFICIAL CONFLICT] Truck #{i + 1} at ({tx:.1f}, {tz:.1f}) is {dist:.1f}m from Event at ({ax:.1f}, {az:.1f})"
                )
                is_safe = False
                conflicts += 1
                break

    if conflicts == 0:
        print("FANTASTIC! The official coordinates are 100% clean for your server.")
    else:
        print(
            f"WARNING: Official coordinates have {conflicts} conflicts with your server's events!"
        )


if __name__ == "__main__":
    check_official_integrity()
